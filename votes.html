<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ë°ì´ì½˜ ë‚¨ì€ íˆ¬í‘œ ê³„ì‚°ê¸°</title>
  <style>
    :root {
      --bg: radial-gradient(circle at 15% 20%, #f6f9ff, #e5ecf6 50%, #dfe7f2 100%);
      --panel: #0b1224;
      --text: #0d1021;
      --muted: #4b5567;
      --accent: #0f8ec7;
      --success: #0d9d68;
      --error: #d13f4f;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      background: var(--bg);
      font-family: "Pretendard", "Noto Sans KR", "Helvetica Neue", "Segoe UI", sans-serif;
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 28px;
    }
    main {
      width: min(1200px, 100%);
      background: rgba(255, 255, 255, 0.92);
      border-radius: 24px;
      box-shadow: 0 15px 60px rgba(13, 16, 33, 0.12);
      border: 1px solid rgba(13, 16, 33, 0.08);
      overflow: hidden;
    }
    header {
      padding: 28px;
      border-bottom: 1px solid rgba(13, 16, 33, 0.06);
      background: linear-gradient(120deg, rgba(15, 142, 199, 0.08), rgba(13, 16, 33, 0));
    }
    h1 {
      margin: 0;
      font-size: clamp(22px, 3vw, 28px);
      letter-spacing: -0.02em;
    }
    header p {
      margin: 10px 0 0;
      color: var(--muted);
      line-height: 1.6;
    }
    .content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(520px, 1fr));
      gap: 18px;
      padding: 22px 24px 26px;
    }
    .card {
      background: #fff;
      border: 1px solid rgba(13, 16, 33, 0.04);
      border-radius: 16px;
      padding: 18px 18px 14px;
      box-shadow: 0 8px 24px rgba(13, 16, 33, 0.06);
    }
    .card h2 {
      margin: 0 0 12px;
      font-size: 17px;
      letter-spacing: -0.01em;
    }
    .status {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(15, 142, 199, 0.12);
      color: var(--accent);
      font-weight: 600;
      font-size: 14px;
    }
    .status.error { background: rgba(209, 63, 79, 0.12); color: var(--error); }
    .status.success { background: rgba(13, 157, 104, 0.12); color: var(--success); }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      margin-top: 10px;
    }
    .stat {
      padding: 14px;
      border-radius: 12px;
      background: linear-gradient(130deg, rgba(15, 142, 199, 0.1), rgba(15, 142, 199, 0.02));
      border: 1px solid rgba(15, 142, 199, 0.15);
    }
    .stat small {
      display: block;
      color: var(--muted);
      margin-bottom: 6px;
      font-weight: 600;
    }
    .stat strong {
      font-size: 18px;
      letter-spacing: -0.01em;
    }
    .stat.subtle {
      background: #f7f8fb;
      border-color: rgba(13, 16, 33, 0.08);
    }
    .list {
      margin: 10px 0 0;
      padding: 0;
      list-style: none;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      gap: 10px;
    }
    .list li {
      padding: 12px 14px;
      border-radius: 10px;
      width: 100%;
      background: #f7f8fb;
      color: #0d1021;
      font-weight: 700;
      text-align: left;
      line-height: 1.45;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
      white-space: normal;
      word-break: keep-all;
    }
    .meta {
      margin-top: 12px;
      color: var(--muted);
      font-size: 14px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px 14px;
    }
    .actions {
      margin-top: 14px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    button {
      border: none;
      border-radius: 12px;
      padding: 10px 14px;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      background: var(--accent);
      color: #fff;
      transition: transform 120ms ease, box-shadow 160ms ease;
      box-shadow: 0 8px 18px rgba(15, 142, 199, 0.25);
    }
    button.secondary {
      background: #fff;
      color: var(--text);
      border: 1px solid rgba(13, 16, 33, 0.08);
      box-shadow: none;
    }
    button:active { transform: translateY(1px); }
    a {
      color: var(--accent);
      font-weight: 700;
      text-decoration: none;
    }
    a:hover { text-decoration: underline; }
    @media (max-width: 760px) {
      body { padding: 18px; }
      .content { grid-template-columns: 1fr; }
      main { border-radius: 18px; }
    }
  </style>
</head>
<body>
  <main>
    <header>
      <h1>ë°ì´ì½˜ ë‚¨ì€ íˆ¬í‘œ ê³„ì‚°ê¸°</h1>
      <p>example.py ë¡œ ê³„ì‚°í•˜ë˜ "ì°¸ê°€íŒ€ ê¸°ì¤€ ë‚¨ì€ ìƒí˜¸ íˆ¬í‘œ ìˆ˜"ë¥¼ ë¸Œë¼ìš°ì €ì—ì„œ ë°”ë¡œ í™•ì¸í•©ë‹ˆë‹¤. ë¦¬ë”ë³´ë“œ í˜ì´ì§€ì˜ ì‹œê°„ í‘œê¸°(ëª‡ ì‹œê°„/ë¶„ ì „ ë“±) ì•ì— ë¶™ì€ ìˆ«ì ê°’ì„ ëª¨ì•„ í•©ì‚°í•©ë‹ˆë‹¤.</p>
    </header>
    <section class="content">
      <article class="card" aria-live="polite">
        <div class="status" id="status">ëŒ€ê¸° ì¤‘ â€“ ìƒˆë¡œê³ ì¹¨ì„ ëˆŒëŸ¬ ê³„ì‚°í•˜ì„¸ìš”</div>
        <div class="grid">
          <div class="stat">
            <small>ì§‘ê³„ëœ ìƒí˜¸ íˆ¬í‘œ ìˆ˜ í•©ê³„</small>
            <strong id="total-votes">-</strong>
          </div>
          <div class="stat">
            <small>ë‚¨ì€ í‘œ ìˆ˜(ì´ë¡ ìƒ)</small>
            <strong id="remaining">-</strong>
          </div>
          <div class="stat subtle">
            <small>ì°¸ê°€íŒ€ ê¸°ì¤€ ì „ì²´ ê°€ëŠ¥ í‘œ ìˆ˜</small>
            <strong id="possible-votes">-</strong>
          </div>
          <div class="stat subtle">
            <small>íŒ€ ìˆ˜</small>
            <strong id="team-count">-</strong>
          </div>
        </div>
        <div class="actions">
          <button id="run-btn" type="button">ë‹¤ì‹œ ê³„ì‚°</button>
          <button id="open-src" type="button" class="secondary">ë¦¬ë”ë³´ë“œ ì—´ê¸°</button>
        </div>
        <div class="meta">
          <span>ì „ì²´ íŒ€ ìˆ˜ ê¸°ì¤€: <strong>182</strong>íŒ€</span>
          <span>íŒ€ì¥ë‹¹ íˆ¬í‘œê¶Œ: <strong>30</strong>í‘œ</span>
          <span id="updated-at">ë§ˆì§€ë§‰ ê³„ì‚°: -</span>
        </div>
        <p id="error" style="color:var(--error); font-weight:700; margin-top:10px; display:none;"></p>
      </article>
      <article class="card">
        <h2>ì¡°íšŒìˆ˜ ë‚®ì€ íŒ€ (ëœë¤ 5 / í•˜ìœ„ 30)</h2>
        <ul class="list" id="sample-list">
          <li>â€“</li>
          <li>â€“</li>
          <li>â€“</li>
        </ul>
        <div class="actions">
          <button id="shuffle-btn" type="button" class="secondary">ğŸ² ë‹¤ì‹œ ë½‘ê¸°</button>
        </div>
        <p class="meta" style="margin-top:14px;">
          GitHubì— ì €ì¥ëœ ì‚¬ì „ ê³„ì‚° ìŠ¤ëƒ…ìƒ·(<code>data/summary.json</code>)ì„ ë¶ˆëŸ¬ì™€ í‘œì‹œí•©ë‹ˆë‹¤. 30ë¶„ë§ˆë‹¤ ìë™ ê°±ì‹ í•˜ë©°, ì¡°íšŒìˆ˜ ê¸°ì¤€ í•˜ìœ„ 30ê°œ íŒ€ ì¤‘ 5ê°œë¥¼ ëœë¤ìœ¼ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.
        </p>
      </article>
    </section>
  </main>
  <script>
    const URL = "https://dacon.io/competitions/official/236624/leaderboard";
    const SUMMARY_URL = "https://raw.githubusercontent.com/sesacs/vote-dashboard/main/data/summary.json";
    const TOTAL_TEAMS = 182;
    const VOTES_PER_TEAM_LEADER = 30;
    const MAX_SAMPLE = 5;

    const els = {
      status: document.getElementById("status"),
      totalVotes: document.getElementById("total-votes"),
      remaining: document.getElementById("remaining"),
      possible: document.getElementById("possible-votes"),
      teamCount: document.getElementById("team-count"),
      updatedAt: document.getElementById("updated-at"),
      sample: document.getElementById("sample-list"),
      error: document.getElementById("error"),
      runBtn: document.getElementById("run-btn"),
      openSrc: document.getElementById("open-src"),
      shuffleBtn: document.getElementById("shuffle-btn"),
    };

    let currentPool = [];

    const format = (n) => new Intl.NumberFormat("ko-KR").format(n);

    function setStatus(text, kind = "info") {
      els.status.textContent = text;
      els.status.className = "status" + (kind === "error" ? " error" : kind === "success" ? " success" : "");
    }

    function shuffleArray(array) {
      const shuffled = [...array];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    function renderSample(posts) {
      els.sample.innerHTML = "";
      if (!posts.length) {
        els.sample.innerHTML = "<li>ê°’ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤</li>";
        return;
      }
      const sample = shuffleArray(posts).slice(0, MAX_SAMPLE);
      sample.forEach((item) => {
        const li = document.createElement("li");
        li.textContent = `${item.title} Â· ì¡°íšŒìˆ˜ ${format(item.views)}`;
        li.title = `${item.title} (ì¡°íšŒìˆ˜ ${format(item.views)})`;
        els.sample.appendChild(li);
      });
    }

    function renderStats({ totalVotes, voteValues, updatedAt, lowViewPool }) {
      const totalPossible = TOTAL_TEAMS * VOTES_PER_TEAM_LEADER;
      const remaining = totalPossible - totalVotes;

      els.totalVotes.textContent = `${format(totalVotes)}í‘œ`;
      els.remaining.textContent = `${format(Math.max(remaining, 0))}í‘œ`;
      els.possible.textContent = `${format(totalPossible)}í‘œ`;
      els.teamCount.textContent = `${voteValues.length}íŒ€`;
      const timeText = updatedAt
        ? new Date(updatedAt).toLocaleString("ko-KR")
        : new Date().toLocaleString("ko-KR");
      els.updatedAt.textContent = `ë§ˆì§€ë§‰ ê³„ì‚°: ${timeText}`;

      currentPool = lowViewPool || [];
      renderSample(currentPool);
    }

    function renderError(message) {
      els.error.style.display = "block";
      els.error.textContent = message;
      setStatus("ê³„ì‚° ì‹¤íŒ¨ â€“ CORS ì°¨ë‹¨ ë˜ëŠ” ì¼ì‹œì  ì˜¤ë¥˜", "error");
    }

    function clearError() {
      els.error.style.display = "none";
      els.error.textContent = "";
    }

    async function fetchSummary() {
      const url = `${SUMMARY_URL}?t=${Date.now()}`;
      const resp = await fetch(url, { cache: "no-store" });
      if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
      const data = await resp.json();
      return data;
    }

    async function calculate() {
      clearError();
      setStatus("ë¦¬ë”ë³´ë“œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...", "info");
      renderSample([]);
      els.totalVotes.textContent = "-";
      els.remaining.textContent = "-";
      els.possible.textContent = "-";
      els.teamCount.textContent = "-";

      try {
        const summary = await fetchSummary();
        renderStats(summary);
        setStatus("ê³„ì‚° ì™„ë£Œ", "success");
      } catch (err) {
        console.error(err);
        renderError("ìŠ¤ëƒ…ìƒ·ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ê±°ë‚˜ ìºì‹œë¥¼ ê°±ì‹ í•˜ì„¸ìš”.");
      }
    }

    els.runBtn.addEventListener("click", calculate);
    els.openSrc.addEventListener("click", () => window.open(URL, "_blank", "noopener"));
    els.shuffleBtn.addEventListener("click", () => {
      if (currentPool.length > 0) {
        renderSample(currentPool);
      }
    });

    calculate();
  </script>
</body>
</html>